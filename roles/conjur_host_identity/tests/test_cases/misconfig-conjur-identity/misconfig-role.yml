---
- name: Configuring conjur identity on remote hosts
  hosts: testapp
  tasks:
      - import_role:
          name: "cyberark.conjur.conjur-host-identity"
        vars:
          conjur_account: cucumber
          conjur_appliance_url: "https://conjur-proxy-nginx/igk"
          conjur_host_factory_token: "{{lookup('env', 'HFTOKEN')}}"
          conjur_host_name: "conjur_{{ ansible_hostname }}"
          conjur_ssl_certificate: "{{lookup('file', '../../conjur.pem')}}"
          conjur_validate_certs: yes
        register: command_result
        ignore_errors: True

      - block:
          - name: Fail if the role did not succeed
            debug:
              msg: " Ansible Conjur Role cyberark.conjur.conjur-host-identity failed  "
        when: command_result is undefined
