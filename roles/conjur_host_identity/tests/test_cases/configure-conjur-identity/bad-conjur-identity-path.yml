---
- name: check if the cyberark.conjur.conjur-host-identity configured correctly
  hosts: testapp
  vars:
      conjur_identity_dir:
      - - /etc/conjur.identity
        - /etc/conjur.pem
        - /etc/conjur.conf
        - /etc/ssl/certs/conjur.crt
  tasks:
    - block:
        - name: Remove files
          file:
            path: "{{ item }}"
            state: absent
          with_items: "{{ conjur_identity_dir }}"

        - name: Ensure all required files are available
          debug:
            msg: "Error: '{{ item }}' is not available"
          when: item.stat.exists is undefined
          with_items: "{{ conjur_identity_dir }}"

      rescue:
        - name: Issue in bad-conjur-identity-path playbook
          debug:
            msg: "Error: Playbook bad-conjur-identity-path could not execute on '{{ inventory_hostname }}' "

      always:
        - name: Come out of the bad-conjur-identity-path playbook
          debug:
            msg: "Playbook bad-conjur-identity-path came out from '{{ inventory_hostname }}' "
