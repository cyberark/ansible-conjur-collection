# conjur policy load -f authn-azure-secrets.yml -b data/myspace
# conjur variable set -i data/myspace/variablespace/demo-variable -v mySecret
# conjur variable set -i data/myspace/variablespace/azure-password -v Azure@p@ssw0rd
- !policy
  id: ansible
  body:
    - !group consumers

    - &variables
      - !variable target-password
      - !variable test-secret
      - !variable test-secret-in-file
      - !variable var with spaces

    - !layer &remote_hosts_layer
      id: remote_hosts
      annotations:
        description: Layer for Ansible remote hosts
  
    - !host-factory
      id: ansible-factory
      annotations:
        description: Factory to create new hosts for Ansible
      layer: [ *remote_hosts_layer ]

    - !grant
      role: *remote_hosts_layer
      member: !group consumers

    - !permit
      role: *remote_hosts_layer
      privileges: [ execute ]
      resource: *variables

    - !permit
      role: !group consumers
      privilege: [ read, execute ]
      resource: *variables

- !grant
  role: !group ansible/consumers
  member: !group azure-apps
